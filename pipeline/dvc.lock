schema: '2.0'
stages:
  create_beyts_embeddings:
    cmd: python src/create_beyts_embeddings.py
    deps:
    - path: .env
      hash: md5
      md5: a4a6bd637dfbb432049cbeaa6f14ec14
      size: 103
    - path: data/raw/ghazal.parquet
      hash: md5
      md5: f0b398559371df0b08306acddd934c67
      size: 2211524
    - path: data/raw/masnavi.parquet
      hash: md5
      md5: 116b8f900523b95f8d65d6157013cdc7
      size: 3652025
    - path: params.yaml
      hash: md5
      md5: 39265a584c52a21c82acc3ca0aa630d5
      size: 11353
    - path: src/create_beyts_embeddings.py
      hash: md5
      md5: 4f87b6e8edfbf0c22cca4d7c8ae4a17f
      size: 4565
    - path: src/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/prepared/beyts_embeddings.parquet
      hash: md5
      md5: 55ce7a7dd4b88f419aa0e1888ecc0c01
      size: 513835640
    - path: data/prepared/ghazal_documents.pkl
      hash: md5
      md5: c13c6851516c563091ea13a5541ffbdb
      size: 7592857
    - path: data/prepared/masnavi_documents.pkl
      hash: md5
      md5: 187a1bff2ae0031f9963997bf1e2f965
      size: 8046188
  snapshot_ghazal_table:
    cmd: python src/snapshot_ghazal_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_ghazal_table.py
      hash: md5
      md5: fc0196e17d0df56327b3d03be45115bb
      size: 587
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/ghazal.parquet
      hash: md5
      md5: f0b398559371df0b08306acddd934c67
      size: 2211524
  snapshot_masnavi_table:
    cmd: python src/snapshot_masnavi_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_masnavi_table.py
      hash: md5
      md5: 6d9863f867582710f220b9aac02c6440
      size: 589
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/masnavi.parquet
      hash: md5
      md5: 116b8f900523b95f8d65d6157013cdc7
      size: 3652025
  create_evaluation_questions:
    cmd: python src/create_evaluation_questions.py
    deps:
    - path: data/prepared/ghazal_documents.pkl
      hash: md5
      md5: a435ee640a3b2cbd53022254e7041f2d
      size: 10919647
    - path: data/prepared/masnavi_documents.pkl
      hash: md5
      md5: a634c7762bf7e11759f2e9739283b262
      size: 7380895
    - path: data/prepared/programs_documents.pkl
      hash: md5
      md5: b1677d069cc1684988e6e0cefd658fce
      size: 49889715
    - path: src/create_evaluation_questions.py
      hash: md5
      md5: c5598f3a9ecc3cf553bbd9d80024e918
      size: 2430
    - path: src/utils/load_model.py
      hash: md5
      md5: 96ed4b51215e086fc8c477ab401961ee
      size: 94
    outs:
    - path: data/prepared/generated_questions.pkl
      hash: md5
      md5: f1905a5ca3d3477cb98aa3177b585a90
      size: 68244
  filter_generated_questions:
    cmd: python src/filter_generated_questions.py
    deps:
    - path: data/prepared/generated_questions.pkl
      hash: md5
      md5: f1905a5ca3d3477cb98aa3177b585a90
      size: 68244
    - path: src/filter_generated_questions.py
      hash: md5
      md5: 3bc1f59253bdd44f5a1f9d80d59b3eca
      size: 2381
    - path: src/utils/load_model.py
      hash: md5
      md5: 96ed4b51215e086fc8c477ab401961ee
      size: 94
    outs:
    - path: data/prepared/evaluation_dataset.parquet
      hash: md5
      md5: fbb50d36a5922b12841863646ac38457
      size: 68553
    - path: evaluation/plots/questions_score_distribution.png
      hash: md5
      md5: 5a0c430dfa2ea98182861f5ed6c798e9
      size: 10627
  evaluate_rag:
    cmd: python src/evaluate_rag.py
    deps:
    - path: data/prepared/evaluation_dataset.parquet
      hash: md5
      md5: 5ccd570df16873c82115f2dec94ae2aa
      size: 36151
    - path: src/evaluate_rag.py
      hash: md5
      md5: ea84bbb11810563d8ff0655abd851837
      size: 3351
    - path: src/utils/create_rag.py
      hash: md5
      md5: f332587d1b34c375733b01b991d21b4a
      size: 5137
    - path: src/utils/load_model.py
      hash: md5
      md5: 96ed4b51215e086fc8c477ab401961ee
      size: 94
    outs:
    - path: evaluation/metrics.json
      hash: md5
      md5: aa42b58f082894ca213e21ff3fd19137
      size: 40
    - path: evaluation/plots/judge_scores.png
      hash: md5
      md5: d48f78f120e2c83bdc8e1fa5c31a2923
      size: 7303
    - path: evaluation/rag_results.json
      hash: md5
      md5: f8f719de85d7340c42c6073caf1dbc07
      size: 62811
  snapshot_masnavi_bakhsh_table:
    cmd: python src/snapshot_masnavi_bakhsh_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_masnavi_bakhsh_table.py
      hash: md5
      md5: 2c4e47bb99758b562cea722530390f11
      size: 603
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/masnavi_bakhsh.parquet
      hash: md5
      md5: df5f0b74179055c3db8072dc2922ac85
      size: 101718
  snapshot_programs_table:
    cmd: python src/snapshot_programs_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_programs_table.py
      hash: md5
      md5: 621cd68d6adda85ebb253b98f43bfebe
      size: 595
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/programs.parquet
      hash: md5
      md5: 10dfcc52e95f3c22b725421ce200bd7b
      size: 19243126
  create_embeddings:
    cmd: python src/create_embeddings.py
    deps:
    - path: data/raw/ghazal_with_translation.parquet
      hash: md5
      md5: d1d63df4e1c5f8790ed3e1263f76f433
      size: 4465034
    - path: data/raw/masnavi.parquet
      hash: md5
      md5: 116b8f900523b95f8d65d6157013cdc7
      size: 3652025
    - path: data/raw/masnavi_bakhsh.parquet
      hash: md5
      md5: df5f0b74179055c3db8072dc2922ac85
      size: 101718
    - path: data/raw/programs_with_translation.parquet
      hash: md5
      md5: 7eecd2292840bd79b5bfe39344442699
      size: 18992273
    - path: src/utils/common_embeddings.py
      hash: md5
      md5: 78c2738720d60a123729ca2d179a7a06
      size: 395
    - path: src/utils/create_embeddings_ghazal.py
      hash: md5
      md5: 80a03edf8de047ade67a272c9ae0a207
      size: 1214
    - path: src/utils/create_embeddings_masnavi.py
      hash: md5
      md5: 772ad0317fa566da8ebf0d235a686812
      size: 1710
    - path: src/utils/create_embeddings_programs.py
      hash: md5
      md5: 45128b47648887fd2ea2903a5df6c3a6
      size: 1185
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/prepared/embeddings.parquet
      hash: md5
      md5: 88ed4b1b23a57e2b2198202ce6193b57
      size: 1055713701
    - path: data/prepared/ghazal_documents.pkl
      hash: md5
      md5: a435ee640a3b2cbd53022254e7041f2d
      size: 10919647
    - path: data/prepared/masnavi_documents.pkl
      hash: md5
      md5: a634c7762bf7e11759f2e9739283b262
      size: 7380895
    - path: data/prepared/programs_documents.pkl
      hash: md5
      md5: b1677d069cc1684988e6e0cefd658fce
      size: 49889715
  create_program_chunks:
    cmd: python src/create_program_chunks.py
    deps:
    - path: data/raw/programs.parquet
      hash: md5
      md5: 10dfcc52e95f3c22b725421ce200bd7b
      size: 19243126
    - path: params.yaml
      hash: md5
      md5: 71fa714f7f88e501df0ff22203e9ec03
      size: 6094
    - path: src/create_program_chunks.py
      hash: md5
      md5: eab1f1231efd5ee6a4842422cbe6106b
      size: 1341
    outs:
    - path: data/raw/programs_chunked.parquet
      hash: md5
      md5: 58f2b7d7f0e3090bc8db6e7dca2a45ee
      size: 18991744
  translate_programs:
    cmd: python src/translate_programs.py
    deps:
    - path: data/raw/programs_chunked.parquet
      hash: md5
      md5: 58f2b7d7f0e3090bc8db6e7dca2a45ee
      size: 18991744
    - path: src/translate_programs.py
      hash: md5
      md5: 7c1bfa729b6548e72d1dcdef5ee7e28f
      size: 912
    - path: src/utils/load_model.py
      hash: md5
      md5: 96ed4b51215e086fc8c477ab401961ee
      size: 94
    outs:
    - path: data/raw/programs_with_translation.parquet
      hash: md5
      md5: 8594f281ecea0e016c9bb5817abb672f
      size: 21409471
  translate_ghazal:
    cmd: python src/translate_ghazal.py
    deps:
    - path: data/raw/ghazal.parquet
      hash: md5
      md5: f0b398559371df0b08306acddd934c67
      size: 2211524
    - path: src/translate_ghazal.py
      hash: md5
      md5: 847a0329b749440ca64b5a4a6c5231fa
      size: 912
    - path: src/utils/load_model.py
      hash: md5
      md5: 96ed4b51215e086fc8c477ab401961ee
      size: 94
    outs:
    - path: data/raw/ghazal_with_translation.parquet
      hash: md5
      md5: f08036af8cd7bcbc416eeed91de0f507
      size: 3478312
