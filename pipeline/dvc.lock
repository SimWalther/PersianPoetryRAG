schema: '2.0'
stages:
  create_beyts_embeddings:
    cmd: python src/create_beyts_embeddings.py
    deps:
    - path: .env
      hash: md5
      md5: a4a6bd637dfbb432049cbeaa6f14ec14
      size: 103
    - path: data/raw/ghazal.parquet
      hash: md5
      md5: f0b398559371df0b08306acddd934c67
      size: 2211524
    - path: data/raw/masnavi.parquet
      hash: md5
      md5: 116b8f900523b95f8d65d6157013cdc7
      size: 3652025
    - path: params.yaml
      hash: md5
      md5: 39265a584c52a21c82acc3ca0aa630d5
      size: 11353
    - path: src/create_beyts_embeddings.py
      hash: md5
      md5: 4f87b6e8edfbf0c22cca4d7c8ae4a17f
      size: 4565
    - path: src/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/prepared/beyts_embeddings.parquet
      hash: md5
      md5: 55ce7a7dd4b88f419aa0e1888ecc0c01
      size: 513835640
    - path: data/prepared/ghazal_documents.pkl
      hash: md5
      md5: c13c6851516c563091ea13a5541ffbdb
      size: 7592857
    - path: data/prepared/masnavi_documents.pkl
      hash: md5
      md5: 187a1bff2ae0031f9963997bf1e2f965
      size: 8046188
  snapshot_ghazal_table:
    cmd: python src/snapshot_ghazal_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_ghazal_table.py
      hash: md5
      md5: fc0196e17d0df56327b3d03be45115bb
      size: 587
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/ghazal.parquet
      hash: md5
      md5: f0b398559371df0b08306acddd934c67
      size: 2211524
  snapshot_masnavi_table:
    cmd: python src/snapshot_masnavi_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_masnavi_table.py
      hash: md5
      md5: 6d9863f867582710f220b9aac02c6440
      size: 589
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/masnavi.parquet
      hash: md5
      md5: 116b8f900523b95f8d65d6157013cdc7
      size: 3652025
  create_evaluation_questions:
    cmd: python src/create_evaluation_questions.py
    deps:
    - path: ../rag/load_model.py
      hash: md5
      md5: e78490fe15b7409932db954ae77ae921
      size: 484
    - path: data/prepared/ghazal_documents.pkl
      hash: md5
      md5: 1e7e5f7beccad41eaff5d074053af4b5
      size: 10395798
    - path: data/prepared/masnavi_documents.pkl
      hash: md5
      md5: 9fc42387702732eeeb313bc904005fe2
      size: 7380895
    - path: data/prepared/programs_documents.pkl
      hash: md5
      md5: 703dca85714fdbdf0efdc522c4fa3f6c
      size: 79862495
    - path: src/create_evaluation_questions.py
      hash: md5
      md5: c5598f3a9ecc3cf553bbd9d80024e918
      size: 2430
    outs:
    - path: data/prepared/generated_questions.pkl
      hash: md5
      md5: 684f0fdf801adcdb8697fa9152c26ed3
      size: 62923
  filter_generated_questions:
    cmd: python src/filter_generated_questions.py
    deps:
    - path: ../rag/load_model.py
      hash: md5
      md5: e78490fe15b7409932db954ae77ae921
      size: 484
    - path: data/prepared/generated_questions.pkl
      hash: md5
      md5: 684f0fdf801adcdb8697fa9152c26ed3
      size: 62923
    - path: src/filter_generated_questions.py
      hash: md5
      md5: 3bc1f59253bdd44f5a1f9d80d59b3eca
      size: 2381
    outs:
    - path: data/prepared/evaluation_dataset.parquet
      hash: md5
      md5: 1b5917b06a7afd283cb90ba696f6da57
      size: 65098
    - path: evaluation/plots/questions_score_distribution.png
      hash: md5
      md5: 0dd66d13e5b1120eb60805e9da1d5c48
      size: 10654
  evaluate_rag:
    cmd: python src/evaluate_rag.py
    deps:
    - path: ../rag/load_model.py
      hash: md5
      md5: e78490fe15b7409932db954ae77ae921
      size: 484
    - path: ../rag/rag.py
      hash: md5
      md5: a688e611c2e0fade1f7394518205e532
      size: 6985
    - path: data/prepared/evaluation_dataset.parquet
      hash: md5
      md5: 1b5917b06a7afd283cb90ba696f6da57
      size: 65098
    - path: src/evaluate_rag.py
      hash: md5
      md5: 0824075f4179b43508bafcee77a4ae58
      size: 4124
    outs:
    - path: evaluation/metrics.json
      hash: md5
      md5: fa5553f1736f2e214adf07dd26c69160
      size: 39
    - path: evaluation/plots/judge_scores.png
      hash: md5
      md5: 9f7d9e1fd8c6228a6e7c6117e12199bd
      size: 6375
    - path: evaluation/rag_results.json
      hash: md5
      md5: e98bab167e8a79afba7e39fc3ca70d05
      size: 111793
  snapshot_masnavi_bakhsh_table:
    cmd: python src/snapshot_masnavi_bakhsh_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_masnavi_bakhsh_table.py
      hash: md5
      md5: 2c4e47bb99758b562cea722530390f11
      size: 603
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/masnavi_bakhsh.parquet
      hash: md5
      md5: df5f0b74179055c3db8072dc2922ac85
      size: 101718
  snapshot_programs_table:
    cmd: python src/snapshot_programs_table.py
    deps:
    - path: .env
      hash: md5
      md5: 7f370a49622d145a9f8f8cba504af002
      size: 150
    - path: src/snapshot_programs_table.py
      hash: md5
      md5: 621cd68d6adda85ebb253b98f43bfebe
      size: 595
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/raw/programs.parquet
      hash: md5
      md5: 10dfcc52e95f3c22b725421ce200bd7b
      size: 19243126
  create_embeddings:
    cmd: python src/create_embeddings.py
    deps:
    - path: data/raw/ghazal_with_translation.parquet
      hash: md5
      md5: 8b9921e9733442b728bb7dd08ee5b254
      size: 4570892
    - path: data/raw/masnavi.parquet
      hash: md5
      md5: 116b8f900523b95f8d65d6157013cdc7
      size: 3652025
    - path: data/raw/masnavi_bakhsh.parquet
      hash: md5
      md5: df5f0b74179055c3db8072dc2922ac85
      size: 101718
    - path: data/raw/programs_with_translation.parquet
      hash: md5
      md5: 829ff33dbcee480fab435ab8f4f5330b
      size: 35555402
    - path: src/utils/common_embeddings.py
      hash: md5
      md5: 78c2738720d60a123729ca2d179a7a06
      size: 395
    - path: src/utils/create_embeddings_ghazal.py
      hash: md5
      md5: 80a03edf8de047ade67a272c9ae0a207
      size: 1214
    - path: src/utils/create_embeddings_masnavi.py
      hash: md5
      md5: 772ad0317fa566da8ebf0d235a686812
      size: 1710
    - path: src/utils/create_embeddings_programs.py
      hash: md5
      md5: 057636a1895441b060c0af01542f149f
      size: 1180
    - path: src/utils/dump_table.py
      hash: md5
      md5: 51d3cef161f9b40b86aed5dc07c5eeef
      size: 591
    outs:
    - path: data/prepared/embeddings.parquet
      hash: md5
      md5: ea3d3196646eb076efee85b294db5e4a
      size: 1072614118
    - path: data/prepared/ghazal_documents.pkl
      hash: md5
      md5: 1e7e5f7beccad41eaff5d074053af4b5
      size: 10395798
    - path: data/prepared/masnavi_documents.pkl
      hash: md5
      md5: 9fc42387702732eeeb313bc904005fe2
      size: 7380895
    - path: data/prepared/programs_documents.pkl
      hash: md5
      md5: 703dca85714fdbdf0efdc522c4fa3f6c
      size: 79862495
  create_program_chunks:
    cmd: python src/create_program_chunks.py
    deps:
    - path: data/raw/programs.parquet
      hash: md5
      md5: 10dfcc52e95f3c22b725421ce200bd7b
      size: 19243126
    - path: params.yaml
      hash: md5
      md5: 71fa714f7f88e501df0ff22203e9ec03
      size: 6094
    - path: src/create_program_chunks.py
      hash: md5
      md5: eab1f1231efd5ee6a4842422cbe6106b
      size: 1341
    outs:
    - path: data/raw/programs_chunked.parquet
      hash: md5
      md5: 58f2b7d7f0e3090bc8db6e7dca2a45ee
      size: 18991744
  translate_programs:
    cmd: python src/translate_programs.py
    deps:
    - path: ../rag/load_model.py
      hash: md5
      md5: 171dfee00e7ca475b745ff6e6de7429d
      size: 281
    - path: data/raw/programs_chunked.parquet
      hash: md5
      md5: 58f2b7d7f0e3090bc8db6e7dca2a45ee
      size: 18991744
    - path: src/translate_programs.py
      hash: md5
      md5: 44ada252ebb0e38c676924aa2b78b614
      size: 1272
    outs:
    - path: data/raw/programs_with_translation.parquet
      hash: md5
      md5: 0020dfcefd89142d995caddc1720dba5
      size: 18866499
  translate_ghazal:
    cmd: python src/translate_ghazal.py
    deps:
    - path: ../rag/load_model.py
      hash: md5
      md5: e78490fe15b7409932db954ae77ae921
      size: 484
    - path: data/raw/ghazal.parquet
      hash: md5
      md5: f0b398559371df0b08306acddd934c67
      size: 2211524
    - path: src/translate_ghazal.py
      hash: md5
      md5: a97d06d100fff7ca3b99cf64233dcc5f
      size: 2782
    outs:
    - path: data/raw/ghazal_with_translation.parquet
      hash: md5
      md5: 8b9921e9733442b728bb7dd08ee5b254
      size: 4570892
